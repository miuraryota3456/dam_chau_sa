// ==UserScript==
// @name         d-l-s-i-t-e
// @namespace    https://github.com/miuraryota3456/dam_chau_sa/raw/main/d-l-s-i-t-e.user.js
// @version      2024.08.09
// @description  down d-l-s-i-t-e
// @author       You
// @include      /^https:\/\/pl[a@]y\.d[l1]sit[e3]\.c[o0]m.+/
// @include      /^https:\/\/pl[a@]y\.d[l1]sit[e3]\.c[o0]m\/csr\/vi[e3]wer/
// @icon         https://raw.githubusercontent.com/miuraryota3456/dam_chau_sa/main/d-l-s-i-t-e.png
// @require      https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/fast-xml-parser/4.2.7/fxparser.min.js
// @require      https://cdn.jsdelivr.net/npm/lodash/lodash.min.js
// @require      https://cdn.jsdelivr.net/npm/deepdash/browser/deepdash.min.js
// @grant        none
// @downloadURL  https://github.com/miuraryota3456/dam_chau_sa/raw/main/d-l-s-i-t-e.user.js
// @updateURL    https://github.com/miuraryota3456/dam_chau_sa/raw/main/d-l-s-i-t-e.meta.js
// ==/UserScript==

(function(_0x1a5ef3,_0x30725f){const _0x2c2bea=a0_0x3489,_0x592fe3=_0x1a5ef3();while(!![]){try{const _0x47501c=-parseInt(_0x2c2bea(0x1ff))/0x1+parseInt(_0x2c2bea(0x1c0))/0x2+parseInt(_0x2c2bea(0x1f6))/0x3+parseInt(_0x2c2bea(0x1b3))/0x4+parseInt(_0x2c2bea(0x1eb))/0x5+-parseInt(_0x2c2bea(0x1d2))/0x6+parseInt(_0x2c2bea(0x1bc))/0x7*(-parseInt(_0x2c2bea(0x20a))/0x8);if(_0x47501c===_0x30725f)break;else _0x592fe3['push'](_0x592fe3['shift']());}catch(_0x162cf4){_0x592fe3['push'](_0x592fe3['shift']());}}}(a0_0x532f,0x4b462));let downloading_current=0x0,downloading_total=0x0;deepdash(_);function sleep(_0x3cb745){return new Promise(_0x282f9f=>setTimeout(_0x282f9f,_0x3cb745));}function a0_0x532f(){const _0xbbe577=['optimized/','createElement','parseInt','include','map','471455eaLHHc','slice','alignItems','block','searchParams','blob','floor','.xml','getDate','transform','height','207ZjMmxA','image','cookie','50vw','getTime','webkitURL','pointer','textContent','ziptree.json','57395giHmXU','join','rel','fetch','count','getContext','display','substring','status','mti','playfile','20104YnMLLI','name','className','seed','parse','status-num','appendChild','offsetX','naturalWidth','&reqtype=0&param=','onload','&time=','then','padStart','clone','string','apply','innerHTML','querySelector','getHours','.status-num','getMonth','offsetY','center','createObjectURL','image/jpeg','naturalHeight','?mode=1&reqtype=0&vm=4&file=','firstChild','absolute','insertBefore','\x20/\x20','getMinutes','url','96948lPQjzR','all','div','translate(-50%)','get','splice','ceil','split','justifyContent','707fxTdom','face.xml','tree','addEventListener','1091086ozWhwG','Result','error','top','toBlob','href','left','now','catch','&param=','URL','src','findPathDeep','setAttribute','width','head','test','style','267660IXpUJY','position','10000','includes','text','json','1.5rem','crop','cgi','cursor','flex','drawImage','Fetch\x20error:','fill','getFullYear','children','stylesheet','link','length','Content'];a0_0x532f=function(){return _0xbbe577;};return a0_0x532f();}const dn=(_0x28f34e,_0x243f51)=>{const _0x308ebd=a0_0x3489,_0x1917fc=document['createElement']('canvas');_0x1917fc[_0x308ebd(0x1ce)]=_0x243f51['w'],_0x1917fc['height']=_0x243f51['h'];const _0x5d14d7=_0x1917fc[_0x308ebd(0x204)]('2d');let _0x1b5932,_0x2976ce,_0x33d1da,_0x5bd383,_0x4382a4=![],_0x38cc43=0x0,_0x378525=0x0,_0x383f98=0x0,_0x5ec27c=_0x243f51[_0x308ebd(0x203)];for(;_0x383f98<(0x0|_0x5ec27c);0x0|(_0x383f98+=0x1)){_0x2976ce=Math[_0x308ebd(0x1f1)](_0x243f51['p'][_0x383f98]*_0x243f51[_0x308ebd(0x1d9)]/(_0x243f51['ws']*_0x243f51[_0x308ebd(0x1d9)])),_0x1b5932=_0x243f51['p'][_0x383f98]-_0x2976ce*_0x243f51['ws'],_0x33d1da=_0x38cc43,_0x5bd383=_0x378525,_0x5d14d7[_0x308ebd(0x1dd)](_0x28f34e,_0x1b5932*_0x243f51[_0x308ebd(0x1d9)],_0x2976ce*_0x243f51['crop'],_0x243f51[_0x308ebd(0x1d9)],_0x243f51['crop'],_0x33d1da*_0x243f51[_0x308ebd(0x1d9)]-(_0x4382a4?0.5:0x0)+_0x243f51[_0x308ebd(0x211)],_0x5bd383*_0x243f51['crop']-(_0x4382a4?0.5:0x0)+_0x243f51[_0x308ebd(0x1a7)],_0x243f51['crop']+(_0x4382a4?0.5:0x0),_0x243f51[_0x308ebd(0x1d9)]+(_0x4382a4?0.5:0x0)),++_0x38cc43*_0x243f51[_0x308ebd(0x1d9)]>=_0x243f51['w']&&(_0x38cc43=0x0,_0x378525++);}return _0x1917fc;},i_mt=_0x12b144=>{const _0x5beb9e=a0_0x3489,_0x526884={'mt':[],'mti':0x0,'numbers':{'e':0x270}};return i_mt_a(_0x12b144,_0x526884),{'mt':_0x526884['mt'],'mti':_0x526884[_0x5beb9e(0x208)]};},i_mt_a=(_0x392998,_0x3248f3)=>{const _0x43ed60=a0_0x3489;!_0x392998&&(_0x392998=new Date()[_0x43ed60(0x1fa)]()),_0x3248f3['mt']=new Array(_0x3248f3['numbers']['e']),_0x3248f3[_0x43ed60(0x208)]=_0x3248f3['numbers']['e']+0x1,i_mt_a_seed(_0x392998,_0x3248f3);},i_mt_a_seed=(_0x311a02,_0x4d224e)=>{const _0x3b602a=a0_0x3489;let _0x161337;_0x4d224e['mt'][0x0]=_0x311a02>>>0x0,_0x4d224e[_0x3b602a(0x208)]=0x1;for(;_0x4d224e['mti']<0x270;_0x4d224e[_0x3b602a(0x208)]++){_0x161337=_0x4d224e['mt'][_0x4d224e['mti']-0x1]^_0x4d224e['mt'][_0x4d224e[_0x3b602a(0x208)]-0x1]>>>0x1e,_0x4d224e['mt'][_0x4d224e[_0x3b602a(0x208)]]=(0x6c078965*((0xffff0000&_0x161337)>>>0x10)<<0x10)+0x6c078965*(0xffff&_0x161337)+_0x4d224e[_0x3b602a(0x208)],_0x4d224e['mt'][_0x4d224e[_0x3b602a(0x208)]]>>>=0x0;}},i_mt_a_int=_0x78193f=>{const _0x1cda39=a0_0x3489;let _0x5e66c4,_0x426896;const _0x1b16d9=[0x0,0x9908b0df];if(_0x78193f[_0x1cda39(0x208)]>=0x270){for(_0x78193f[_0x1cda39(0x208)]===0x270+0x1&&i_mt_a_seed[_0x1cda39(0x20d)](0x1571,_0x78193f),_0x426896=0x0;_0x426896<0x270-0x18d;_0x426896++){_0x5e66c4=_0x78193f['mt'][_0x426896]&0x80000000|_0x78193f['mt'][_0x426896+0x1]&0x7fffffff,_0x78193f['mt'][_0x426896]=_0x78193f['mt'][_0x426896+0x18d]^_0x5e66c4>>>0x1^_0x1b16d9[0x1&_0x5e66c4];}for(;_0x426896<0x270-0x1;_0x426896++){_0x5e66c4=_0x78193f['mt'][_0x426896]&0x80000000|_0x78193f['mt'][_0x426896+0x1]&0x7fffffff,_0x78193f['mt'][_0x426896]=_0x78193f['mt'][_0x426896+(0x18d-0x270)]^_0x5e66c4>>>0x1^_0x1b16d9[0x1&_0x5e66c4];}_0x5e66c4=_0x78193f['mt'][0x270-0x1]&0x80000000|_0x78193f['mt'][0x0]&0x7fffffff,_0x78193f['mt'][0x270-0x1]=_0x78193f['mt'][0x18d-0x1]^_0x5e66c4>>>0x1^_0x1b16d9[0x1&_0x5e66c4],_0x78193f[_0x1cda39(0x208)]=0x0;}return _0x5e66c4=_0x78193f['mt'][_0x78193f['mti']++],_0x5e66c4^=_0x5e66c4>>>0xb,_0x5e66c4^=_0x5e66c4<<0x7&0x9d2c5680,_0x5e66c4^=_0x5e66c4<<0xf&0xefc60000,(_0x5e66c4^=_0x5e66c4>>>0x12)>>>0x0;},o_random=_0x50f074=>{const _0x2202f0=0x100000000;return i_mt_a_int(_0x50f074)*(0x1/_0x2202f0);},fn=function(_0x5e6281){const _0x2be1a1=a0_0x3489;let _0x3994c4,_0x195774,_0x4acc74,_0x46c3f1=i_mt(_0x5e6281['s']),_0x9e10e5=[];for(_0x3994c4=0x0,_0x195774=_0x5e6281[_0x2be1a1(0x203)];_0x3994c4<(0x0|_0x195774);_0x3994c4=_0x3994c4+0x1|0x0){_0x9e10e5['push'](_0x3994c4);}for(_0x195774=_0x9e10e5[_0x2be1a1(0x1e4)];_0x195774;){_0x3994c4=Math[_0x2be1a1(0x1f1)](o_random(_0x46c3f1)*_0x195774),_0x4acc74=_0x9e10e5[_0x195774=_0x195774-0x1|0x0],_0x9e10e5[_0x195774]=_0x9e10e5[_0x3994c4],_0x9e10e5[_0x3994c4]=_0x4acc74;}let _0x1fb7a5={};for(_0x3994c4=0x0,_0x195774=_0x9e10e5[_0x2be1a1(0x1e4)];_0x3994c4<(0x0|_0x195774);_0x3994c4=_0x3994c4+0x1|0x0){_0x1fb7a5[_0x9e10e5[_0x3994c4]]=_0x3994c4;}let _0x4d692b={};for(_0x3994c4=0x0,_0x195774=_0x9e10e5[_0x2be1a1(0x1e4)];_0x3994c4<(0x0|_0x195774);_0x3994c4=_0x3994c4+0x1|0x0){_0x4d692b[_0x3994c4]=_0x1fb7a5[_0x3994c4];}return _0x46c3f1=null,_0x5e6281=null,_0x1fb7a5=null,_0x4d692b;},download_encrypted=async(_0x21ad39,_0x3be58b,_0x57d5af,_0x11bce4)=>{const _0x4cb60d=a0_0x3489,_0x4aa381=_0x21ad39[_0x4cb60d(0x20b)],_0x1a00b7=await fetch(_0x57d5af+_0x4cb60d(0x1e6)+_0x3be58b[_0x4cb60d(0x20b)],{'method':'GET','credentials':_0x4cb60d(0x1e9)}),_0x7042fb=await _0x1a00b7[_0x4cb60d(0x1f0)](),_0x352e98=window[_0x4cb60d(0x1ca)]||window['webkitURL'],_0x1b4180=_0x352e98[_0x4cb60d(0x1a9)](_0x7042fb);let _0x38241e=new Image(_0x3be58b[_0x4cb60d(0x1ce)],_0x3be58b[_0x4cb60d(0x1f5)]);_0x38241e[_0x4cb60d(0x19b)]=async()=>{const _0x50a1cb=_0x4cb60d,_0x2b358f={'crop':0x80,'offsetX':_0x3be58b['offsetX']||0x0,'offsetY':_0x3be58b[_0x50a1cb(0x1a7)]||0x0,'w':_0x3be58b[_0x50a1cb(0x1ce)],'h':_0x3be58b[_0x50a1cb(0x1f5)],'ws':0x0,'hs':0x0,'count':0x0,'s':Number['parseInt'](_0x3be58b[_0x50a1cb(0x20b)][_0x50a1cb(0x206)](0x5,0xc),0x10),'p':null};_0x2b358f['ws']=Math['ceil'](_0x2b358f['w']/_0x2b358f['crop']),_0x2b358f['hs']=Math[_0x50a1cb(0x1b9)](_0x2b358f['h']/_0x2b358f[_0x50a1cb(0x1d9)]),_0x2b358f['count']=_0x2b358f['ws']*_0x2b358f['hs'],_0x2b358f['p']=fn(_0x2b358f);const _0x2ecad=dn(_0x38241e,_0x2b358f);_0x2ecad[_0x50a1cb(0x1c4)](_0x3e1c1f=>{saveAs(_0x3e1c1f,_0x4aa381),downloading_current+=0x1,update_status();},'image/jpeg',0.97);},_0x38241e['src']=_0x1b4180;};function update_status(){const _0x3ee8e0=a0_0x3489;document[_0x3ee8e0(0x1a3)](_0x3ee8e0(0x1a5))[_0x3ee8e0(0x1d1)][_0x3ee8e0(0x205)]=_0x3ee8e0(0x1ee),document[_0x3ee8e0(0x1a3)](_0x3ee8e0(0x1a5))[_0x3ee8e0(0x1a2)]=downloading_current+'\x20/\x20'+downloading_total;}function create_status_box(){const _0x50db05=a0_0x3489;let _0x1a19fe=document[_0x50db05(0x1e7)](_0x50db05(0x1b5));return _0x1a19fe['className']=_0x50db05(0x20f),_0x1a19fe[_0x50db05(0x1fd)]=downloading_current+_0x50db05(0x1b0)+downloading_total,_0x1a19fe;}function a0_0x3489(_0x4db4ac,_0x29876d){const _0x532fc8=a0_0x532f();return a0_0x3489=function(_0x348968,_0x4dec01){_0x348968=_0x348968-0x199;let _0x52542e=_0x532fc8[_0x348968];return _0x52542e;},a0_0x3489(_0x4db4ac,_0x29876d);}function create_download_icon(){const _0xabbbce=a0_0x3489;let _0x363089=document['createElement'](_0xabbbce(0x1b5)),_0x1fe806=document[_0xabbbce(0x1e7)]('img');_0x1fe806[_0xabbbce(0x1cd)](_0xabbbce(0x1cb),'https://github.com/NAgEustiCa/1_con_kien_2_con_kien/raw/main/tai_icon.png'),_0x1fe806[_0xabbbce(0x1d1)][_0xabbbce(0x1ce)]='3rem',_0x1fe806[_0xabbbce(0x1d1)][_0xabbbce(0x1db)]=_0xabbbce(0x1fc),_0x363089[_0xabbbce(0x210)](_0x1fe806);let _0x30ffa0=document[_0xabbbce(0x1e7)](_0xabbbce(0x1e3));_0x30ffa0[_0xabbbce(0x201)]=_0xabbbce(0x1e2),_0x30ffa0['href']='https://fonts.googleapis.com/css2?family=Acme&display=swap',document['getElementsByTagName']('head')[0x0][_0xabbbce(0x210)](_0x30ffa0);let _0x20e138=document[_0xabbbce(0x1e7)](_0xabbbce(0x1b5));_0x20e138[_0xabbbce(0x20c)]=_0xabbbce(0x207),_0x20e138[_0xabbbce(0x1d1)][_0xabbbce(0x205)]=_0xabbbce(0x1dc),_0x20e138['style'][_0xabbbce(0x1bb)]=_0xabbbce(0x1a8),_0x20e138[_0xabbbce(0x1d1)][_0xabbbce(0x1ed)]='center',_0x20e138[_0xabbbce(0x1d1)]['gap']=_0xabbbce(0x1d8),_0x20e138[_0xabbbce(0x1d1)][_0xabbbce(0x1d3)]=_0xabbbce(0x1ae),_0x20e138[_0xabbbce(0x1d1)]['zIndex']=_0xabbbce(0x1d4),_0x20e138[_0xabbbce(0x1d1)][_0xabbbce(0x1c3)]='0.5rem',_0x20e138[_0xabbbce(0x1d1)][_0xabbbce(0x1c6)]=_0xabbbce(0x1f9),_0x20e138[_0xabbbce(0x1d1)][_0xabbbce(0x1f4)]=_0xabbbce(0x1b6);let _0x248535=create_status_box();const _0x3aaa41=document[_0xabbbce(0x1e7)](_0xabbbce(0x1d1));_0x3aaa41['textContent']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20.status-num\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27Acme\x27,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x203rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#FD7377;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-webkit-text-stroke:\x201px\x20#C62428;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x200.2rem\x20solid\x20#167975;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x201rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200\x202rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background-color:\x20#F9FDFD;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200.25rem\x200.4rem\x20#2E8B87;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20',document[_0xabbbce(0x1cf)]['appendChild'](_0x3aaa41),_0x20e138[_0xabbbce(0x210)](_0x363089),_0x20e138[_0xabbbce(0x210)](_0x248535);let _0x3465ae=document['querySelector']('body'),_0x1d77fa=_0x3465ae[_0xabbbce(0x1ad)];return _0x3465ae[_0xabbbce(0x1af)](_0x20e138,_0x1d77fa),_0x20e138;}const throttlePromises=async(_0x580276,_0x1a2222)=>{const _0x1ed260=a0_0x3489;while(_0x580276[_0x1ed260(0x1e4)]>0x0){await Promise[_0x1ed260(0x1b4)](_0x580276[_0x1ed260(0x1b8)](0x0,_0x1a2222)[_0x1ed260(0x1ea)](_0x2c99f4=>_0x2c99f4())),await sleep(0xc8);}},get_data_need=_0x2beb00=>{return new Promise((_0x2c6abc,_0x2906f3)=>{const _0x1bb660=a0_0x3489,_0x18c1bf=window[_0x1bb660(0x202)];window['fetch']=function(){const _0x295031=_0x1bb660;let _0x45bb9b=arguments[0x0];return _0x45bb9b instanceof Request&&(_0x45bb9b=_0x45bb9b[_0x295031(0x1b2)]),typeof _0x45bb9b===_0x295031(0x1a0)&&_0x45bb9b[_0x295031(0x1d5)](_0x2beb00)?_0x18c1bf[_0x295031(0x1a1)](this,arguments)[_0x295031(0x19d)](_0x38b6ec=>{const _0x1eedcd=_0x295031,_0x3c7647=_0x38b6ec[_0x1eedcd(0x19f)]();return _0x3c7647[_0x1eedcd(0x1d7)]()[_0x1eedcd(0x19d)](_0x599169=>{return _0x2c6abc(_0x599169),_0x38b6ec;})['catch'](_0x152a33=>{return _0x2906f3(_0x152a33),_0x38b6ec;});})[_0x295031(0x1c8)](_0x5dc126=>{const _0x11a1c0=_0x295031;console[_0x11a1c0(0x1c2)]('Fetch\x20error:',_0x5dc126),_0x2906f3(_0x5dc126);}):_0x18c1bf[_0x295031(0x1a1)](this,arguments);};});},download_dlsite_book=async()=>{const _0x2b50b9=a0_0x3489,{url:_0x3b1f57}=await get_data_need(_0x2b50b9(0x1f8)),_0x1b7deb=await get_data_need(_0x2b50b9(0x1fe)),_0x45ff36=_[_0x2b50b9(0x1cc)](_0x1b7deb['tree'],(_0x4c9432,_0x5835fb,_0x56a39c)=>{const _0x373410=_0x2b50b9;if(_0x5835fb==='hashname'&&/\.jpg$/[_0x373410(0x1d0)](_0x4c9432))return!![];});let _0x72ba7c=_0x1b7deb[_0x2b50b9(0x1be)];if(_0x45ff36[_0x2b50b9(0x1d5)](_0x2b50b9(0x1e1))){const _0x5305a0=_0x45ff36[_0x2b50b9(0x1ba)]('.')[_0x2b50b9(0x1ec)](0x0,-0x2)[_0x2b50b9(0x200)]('.');_0x72ba7c=_[_0x2b50b9(0x1b7)](_0x1b7deb[_0x2b50b9(0x1be)],_0x5305a0)['children'];}const _0x5d617f=_0x1b7deb[_0x2b50b9(0x209)];if(_0x72ba7c['length']>0x0){downloading_total=_0x72ba7c[_0x2b50b9(0x1e4)];const _0x82f8fd=create_download_icon();_0x82f8fd[_0x2b50b9(0x1bf)]('click',async()=>{const _0x1de98d=_0x2b50b9;downloading_current=0x0;const _0x384e40=_0x72ba7c[_0x1de98d(0x1ea)]((_0x3bbc20,_0x5227bc)=>()=>{const _0x33484e=_0x1de98d,_0x4a9ec1=_0x5d617f[_0x3bbc20['hashname']][_0x33484e(0x1f7)]['optimized'];download_encrypted(_0x3bbc20,_0x4a9ec1,_0x3b1f57,_0x5227bc);});await throttlePromises(_0x384e40,0x2);});}},get_data_need_xml=_0xfd98a7=>{return new Promise((_0x329864,_0x119804)=>{const _0x1081e1=a0_0x3489,_0x5cbdc8=window['fetch'];window[_0x1081e1(0x202)]=function(){const _0x599c0b=_0x1081e1;let _0x5ef000=arguments[0x0];return _0x5ef000 instanceof Request&&(_0x5ef000=_0x5ef000[_0x599c0b(0x1b2)]),typeof _0x5ef000===_0x599c0b(0x1a0)&&_0x5ef000['includes'](_0xfd98a7)?_0x5cbdc8[_0x599c0b(0x1a1)](this,arguments)['then'](_0x136ad2=>{const _0x50c600=_0x599c0b,_0xefac99=_0x136ad2[_0x50c600(0x19f)]();return _0xefac99['text']()[_0x50c600(0x19d)](_0x3dbfd1=>{return _0x329864(_0x3dbfd1),_0x136ad2;})[_0x50c600(0x1c8)](_0x11e6fb=>{return _0x119804(_0x11e6fb),_0x136ad2;});})[_0x599c0b(0x1c8)](_0x29119a=>{const _0x40da74=_0x599c0b;console[_0x40da74(0x1c2)](_0x40da74(0x1de),_0x29119a),_0x119804(_0x29119a);}):_0x5cbdc8[_0x599c0b(0x1a1)](this,arguments);};});},download_dlsite=async()=>{const _0x4289e0=a0_0x3489,_0x565157=document['location'][_0x4289e0(0x1c5)],_0x18933f=new URL(_0x565157)[_0x4289e0(0x1ef)],_0xb48391=_0x18933f[_0x4289e0(0x1b7)](_0x4289e0(0x1da)),_0x56c0ce=_0x18933f[_0x4289e0(0x1b7)]('param'),_0x213e23=await get_data_need_xml(['d','i','a','z','e','p','a','m','_','h','y','b','r','i','d','.','p','h','p','?','m','o','d','e','=','9','9','9'][_0x4289e0(0x200)]('')),_0x33868d=new XMLParser(),_0x528f3d=_0x33868d[_0x4289e0(0x20e)](_0x213e23),_0x2528d5=_0x528f3d[_0x4289e0(0x1c1)][_0x4289e0(0x1e5)],_0x5139c3=await get_data_need_xml(_0x4289e0(0x1bd)),_0x574876=_0x33868d[_0x4289e0(0x20e)](_0x5139c3),{TotalPage:_0x5c32cd,Scramble:{Width:_0x57909e,Height:_0x2472b2}}=_0x574876['Face'],_0x5ecf43=Number[_0x4289e0(0x1e8)](_0x5c32cd,0xa),_0x48498e=Number[_0x4289e0(0x1e8)](_0x57909e,0xa),_0x31e5da=Number['parseInt'](_0x2472b2,0xa),_0x39f7ab=new Date(),_0x578874=_0x39f7ab[_0x4289e0(0x1e0)](),_0x4b5975=String(_0x39f7ab[_0x4289e0(0x1a6)]()+0x1)[_0x4289e0(0x19e)](0x2,'0'),_0x50d81a=String(_0x39f7ab[_0x4289e0(0x1f3)]())['padStart'](0x2,'0'),_0x1f0e62=String(_0x39f7ab[_0x4289e0(0x1a4)]())[_0x4289e0(0x19e)](0x2,'0'),_0x382e36=String(_0x39f7ab[_0x4289e0(0x1b1)]())['padStart'](0x2,'0'),_0x255404=String(_0x39f7ab['getSeconds']())['padStart'](0x2,'0'),_0x4c2f9f=_0x578874+'-'+_0x4b5975+'-'+_0x50d81a+'T'+_0x1f0e62+':'+_0x382e36+':'+_0x255404;if(_0x5ecf43>0x0){downloading_total=_0x5ecf43;const _0x306a19=create_download_icon();_0x306a19[_0x4289e0(0x1bf)]('click',async()=>{const _0x463172=_0x4289e0;downloading_current=0x0;const _0x39bb3d=Array(_0x5ecf43)[_0x463172(0x1df)](0x0),_0x2d8e5a=_0x39bb3d[_0x463172(0x1ea)]((_0x2dbe8f,_0x17c16b)=>async()=>{const _0x529d2b=_0x463172,_0x39d29f=(''+_0x17c16b)['padStart'](0x4,'0')+_0x529d2b(0x1f2),_0x161ad8=await fetch(_0xb48391+'?mode=8&file='+_0x39d29f+_0x529d2b(0x19a)+encodeURIComponent(_0x2528d5)+_0x529d2b(0x19c)+Date[_0x529d2b(0x1c7)]()%0x989680),_0x791892=await _0x161ad8[_0x529d2b(0x1d6)](),_0xb2d1fa=_0x33868d[_0x529d2b(0x20e)](_0x791892),_0x572b77=_0xb2d1fa['Page']['Scramble'],_0x569ccf=_0x572b77['split'](',')[_0x529d2b(0x1ea)](_0xb4a941=>Number[_0x529d2b(0x1e8)](_0xb4a941,0xa));await draw_scramble({'scramble_list':_0x569ccf,'cgi':_0xb48391,'page_index':_0x17c16b,'param_for_api':_0x2528d5,'scramble_w':_0x48498e,'scramble_h':_0x31e5da});});await throttlePromises(_0x2d8e5a,0x2);});}},draw_scramble=async({scramble_list:_0x302469,cgi:_0xb836b,page_index:_0x168102,param_for_api:_0x395d5e,scramble_w:_0x5b1a4c,scramble_h:_0x42b722})=>{const _0x553c4c=a0_0x3489,_0x3854c9=0x8,_0x5ad428=(''+_0x168102)[_0x553c4c(0x19e)](0x4,'0')+'_0000.bin',_0x56f3d8=await fetch(_0xb836b+_0x553c4c(0x1ac)+_0x5ad428+_0x553c4c(0x1c9)+encodeURIComponent(_0x395d5e)+_0x553c4c(0x19c)+Date[_0x553c4c(0x1c7)]()%0x989680),_0x832603=await _0x56f3d8[_0x553c4c(0x1f0)](),_0x2505b0=window[_0x553c4c(0x1ca)]||window[_0x553c4c(0x1fb)],_0x380c4d=_0x2505b0[_0x553c4c(0x1a9)](_0x832603);let _0x3babe6=new Image();_0x3babe6[_0x553c4c(0x19b)]=async()=>{const _0x5d53a8=_0x553c4c,_0x241131={'width':Number[_0x5d53a8(0x1e8)](_0x3babe6[_0x5d53a8(0x199)],0xa),'height':Number[_0x5d53a8(0x1e8)](_0x3babe6[_0x5d53a8(0x1ab)],0xa)},_0x32195f=document[_0x5d53a8(0x1e7)]('canvas');_0x32195f[_0x5d53a8(0x1ce)]=_0x241131[_0x5d53a8(0x1ce)],_0x32195f[_0x5d53a8(0x1f5)]=_0x241131[_0x5d53a8(0x1f5)];const _0xf7eaa0=((_0x241131[_0x5d53a8(0x1ce)]/_0x5b1a4c|0x0)/_0x3854c9|0x0)*_0x3854c9,_0x227f2f=((_0x241131[_0x5d53a8(0x1f5)]/_0x42b722|0x0)/_0x3854c9|0x0)*_0x3854c9,_0x516282=_0xf7eaa0*_0x5b1a4c,_0x52e6ed=_0x227f2f*_0x42b722,_0x3ceca1=_0x32195f[_0x5d53a8(0x204)]('2d');h_drawImage(_0x3babe6,_0x3ceca1,_0x241131[_0x5d53a8(0x1ce)]-_0x516282,_0x52e6ed,_0x516282,0x0,_0x516282,0x0),h_drawImage(_0x3babe6,_0x3ceca1,_0x241131[_0x5d53a8(0x1ce)],_0x241131[_0x5d53a8(0x1f5)]-_0x52e6ed,0x0,_0x52e6ed,0x0,_0x52e6ed);for(let _0x4076c0=0x0;_0x4076c0<_0x42b722;++_0x4076c0){for(let _0x17bd0b=0x0;_0x17bd0b<_0x5b1a4c;++_0x17bd0b){const _0x22d24a=_0x302469[_0x4076c0*_0x5b1a4c+_0x17bd0b],_0x4a4f13=_0x22d24a/_0x5b1a4c|0x0,_0x20e602=_0x22d24a-_0x4a4f13*_0x5b1a4c,_0x4bfc81=_0x20e602*_0xf7eaa0,_0x2105da=_0x4a4f13*_0x227f2f,_0x3ad040=_0x17bd0b*_0xf7eaa0,_0x2fdae5=_0x4076c0*_0x227f2f;h_drawImage(_0x3babe6,_0x3ceca1,_0xf7eaa0,_0x227f2f,_0x4bfc81,_0x2105da,_0x3ad040,_0x2fdae5);}}_0x32195f['toBlob'](_0x1458ab=>{saveAs(_0x1458ab,(''+(_0x168102+0x1))['padStart'](0x3,'0')+'.jpg'),downloading_current+=0x1,update_status();},_0x5d53a8(0x1aa),0.97);},_0x3babe6[_0x553c4c(0x1cb)]=_0x380c4d;},h_drawImage=(_0xfc4de4,_0x5e6a1e,_0x57659d,_0x3ff208,_0x4438d1,_0x501c36,_0x3dc02c,_0x14353a)=>{const _0x261fff=a0_0x3489;if(_0x57659d<=0x0||_0x3ff208<=0x0)return;_0x5e6a1e[_0x261fff(0x1dd)](_0xfc4de4,_0x4438d1,_0x501c36,_0x57659d,_0x3ff208,_0x3dc02c,_0x14353a,_0x57659d,_0x3ff208);};((async()=>{const _0x10b18c=a0_0x3489,_0x1af3ef=document['location'][_0x10b18c(0x1c5)];if(_0x1af3ef[_0x10b18c(0x1d5)](['p','l','a','y','.','d','l','s','i','t','e','.','c','o','m','/','c','s','r','/','v','i','e','w','e','r'][_0x10b18c(0x200)]('')))await download_dlsite();else _0x1af3ef[_0x10b18c(0x1d5)](['h','t','t','p','s',':','/','/','p','l','a','y','.','d','l','s','i','t','e','.','c','o','m','/','#','/','w','o','r','k']['join'](''))&&await download_dlsite_book();})());